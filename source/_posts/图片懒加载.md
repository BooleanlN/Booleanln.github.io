---
title: 图片懒加载
date: 2019-06-25 19:31:04
tags:
- javaScript
- web性能优化
---

### 图片懒加载实现

- html

```html
<div class="img-warpper">
		<img class="lazyload" data-original="https://media3.giphy.com/media/k5GuJn7VslbpGQqHUB/200w.webp">
</div>
<div class="img-warpper">
  	<img class="lazyload" data-original="https://media1.giphy.com/media/2A7yoKf2B87kotTApZ/200w.webp">
</div>
<div class="img-warpper">
  <img class="lazyload" data-original="https://media2.giphy.com/media/3h1rwFW1PpLxD9xLUR/200w.webp">
</div>
<div class="img-warpper">
  <img class="lazyload" data-original="https://media0.giphy.com/media/igHgY3xzYxmRcxwZBs/200w.webp">
</div>
<div class="img-warpper">
  <img class="lazyload" data-original="https://media0.giphy.com/media/69v5dFsLtzdpaFZz2N/200w.webp">
</div>
```

- css

```css
body {
		text-align: center;
	}

img {
  width: 100%;
  max-width: 300px;
  height: 200px;
  margin-bottom: 100px; // 为了方便看效果，将图片尽可能的撑开
 }
```

- js

```js
class LazyLoad{
	constructor (el) {
		this.imgList = Array.from(document.querySelectorAll(el))
		this.init()
	}
	canLoad () {
		let imgList = this.imgList
		for(let i=imgList.length;i--;){
			this.getBound(imgList[i]) && this.loadImg(imgList[i], i)
		}
	}
	getBound (el) {
		// 获得图片所在盒框的像素位置
		let bound = el.getBoundingClientRect()
		let clientHeight = window.innerHeight // 窗口可视区域高度
		return bound.top <= clientHeight - 99
	}
	//加载图片
	loadImg (el, index) {
		let src = el.getAttribute("data-original")
		el.src = src
		this.imgList.splice(index, 1)
	}
	bindEvent () {
		window.addEventListener('scroll', () => {
			this.imgList.length && this.canLoad()
		})
	}
	init () {
		this.canLoad()
		this.bindEvent()
	}
}
const lazy = new LazyLoad('.lazyload')
```

